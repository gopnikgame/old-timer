# Old-Timer Telegram Bot

## Описание

Old-Timer - это Telegram-бот, написанный на Python с использованием фреймворка Aiogram, предназначенный для модерации и управления группами в Telegram. Бот предоставляет функциональность для управления кармой пользователей, предсказаний и другие полезные функции.

## Структура проекта

```
old-timer/
├── app/
│   ├── __init__.py
│   ├── bot.py          # Основной файл бота
│   ├── config.py       # Файл конфигурации
│   ├── db/             # Модуль для работы с базой данных
│   │   ├── __init__.py
│   │   ├── database.py   # Подключение к PostgreSQL
│   │   ├── karma.py      # Функции для управления кармой
│   │   └── predictions.py # Функции для работы с предсказаниями
│   ├── handlers/      # Обработчики команд и сообщений
│   │   ├── __init__.py
│   │   ├── base.py       # Базовые команды бота
│   ├── middlewares/   # Промежуточное ПО для обработки сообщений
│   │   ├── __init__.py
│   │   ├── logging.py    # Логирование действий
│   │   └── topic_check.py # Проверка топика
│   └── utils/         # Вспомогательные функции
│       ├── __init__.py
│       └── formatting.py # Форматирование текста
├── scripts/       # Скрипты для управления ботом
│   └── manage_bot.sh # Скрипт для управления ботом (запуск, остановка, обновление и т.д.)
├── data/          # Данные
│   └── initial_predictions.json # Файл с начальными предсказаниями
├── launcher.sh   # Скрипт для автоматической установки
├── .env.example  # Пример файла с переменными окружения
├── .gitignore    # Файл с исключениями для Git
├── docker-compose.yml # Файл для Docker Compose
├── LICENSE       # Лицензия
└── README.md     # Этот файл
```

## Требования

*   Python 3.9+
*   Docker
*   Docker Compose
*   Git

## Установка

### Ручная установка

1.  Клонируйте репозиторий:

    ```bash
    git clone https://github.com/gopnikgame/old-timer.git
    cd old-timer
    ```

2.  Создайте и настройте файл `.env` на основе `.env.example`.

3.  Заполните необходимые переменные окружения:

    *   `BOT_TOKEN` - Токен вашего Telegram-бота, полученный от BotFather.
    *   `GROUP_ID` - ID группы, в которой будет работать бот.
    *   `ALLOWED_TOPIC_ID` - ID разрешенного топика.
    *   `ALLOWED_TOPIC_URL` - URL разрешенного топика.
    *   `ALLOWED_IDS` - Список ID пользователей, имеющих доступ к административным командам.
    *   `DEEPSEEK_API_KEY` - API-ключ для доступа к DeepSeek (опционально).
    *   `DEEPSEEK_DAILY_LIMIT` - Дневной лимит запросов к DeepSeek (опционально, по умолчанию 5).
    *   `POSTGRES_USER` - Имя пользователя PostgreSQL (по умолчанию postgres).
    *   `POSTGRES_PASSWORD` - Пароль пользователя PostgreSQL (по умолчанию postgres).
    *   `POSTGRES_DB` - Имя базы данных PostgreSQL (по умолчанию botdb).
    *   `POSTGRES_HOST` - Хост базы данных PostgreSQL (по умолчанию db).
    *   `INITIAL_PREDICTIONS_FILE` - Путь к файлу с начальными предсказаниями (по умолчанию data/initial_predictions.json).

4.  Запустите бота с помощью Docker Compose:

    ```bash
    docker-compose up -d
    ```

### Автоматическая установка скриптом

Для автоматической установки и управления ботом используйте следующий скрипт:

1.  Загрузите и выполните скрипт:

    ```bash
    curl -s https://raw.githubusercontent.com/gopnikgame/old-timer/main/launcher.sh -o /tmp/launcher.sh && sudo bash /tmp/launcher.sh
    ```

Скрипт выполнит следующие действия:

*   Проверит наличие необходимых зависимостей (git, docker, docker-compose, nano).
*   Клонирует репозиторий в директорию `/opt/old-timer`.
*   Запустит скрипт `manage_bot.sh` для настройки и запуска бота.

## Управление ботом

Для управления ботом используйте скрипт `manage_bot.sh`, который находится в директории `scripts/`. Скрипт предоставляет следующие опции:

*   Обновление из репозитория
*   Создание или редактирование .env файла
*   Сборка и запуск контейнера бота
*   Остановка и удаление контейнера бота
*   Просмотр логов
*   Просмотр логов ошибок
*   Перезапуск бота
*   Очистка старых логов и бэкапов (не реализовано)
*   Очистка Docker

## Лицензия

Этот проект лицензирован в соответствии с условиями лицензии [LICENSE](LICENSE).